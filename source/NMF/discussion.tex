
\section{Discussion}

A significant challenge in metagenomic data analysis is distinguishing important functions and informative patterns from the thousands of functions and/or taxa that are initially identified. In this study, we illustrated how NMF could be used to find functional patterns without supervision.  We approximated the GOS dataset of over 6,000,000 unique protein sequences, representing 8214 Pfam abundances distributed across 45 sites, as a combination of five components, each with a characteristic functional profile and site profile. We showed that using this NMF decomposition as a lens allowed identification of novel patterns of clustering of Pfams, and overlaps between these clusters.  We looked for groups of Pfams whose distribution across sites was strongly correlated with the identified components, and found three examples of components in which there were identifiable trends in functional annotation corresponding to signalling, photosystem, and phage-associated Pfams.

The NMF lens also allowed us to identify overlapping clusters of the 45 sites in our study.  Again, this gave us a novel view on the relationship between sites.   In particular, NMF filtering yielded sharper patterns of site similarity than are seen with directly measured similarity or PCA-based similarity (\fref{SimilarityCompare}). We also found evidence that functional profiles of sites were more strongly correlated with environmental distance than with geographic distance.  This correlation has been observed before in the GOS dataset \cite{raes_toward_2011}, where function was inferred using the KEGG database, rather than the Pfam database used here.  In this case, we found that the use of NMF filtering greatly increased the amount of overall correlation seen.  This is likely due to filtered distances being less dependent on differences in ubiquitous Pfams.  We suggest that filtered distances, and NMF filtering in particular, may provide an improved means to measure the functional distance between sites.

%There have been many recent calls for quantifying the relationship between microbial function and environmental conditions \cite{MartBoha06,GreeBoha06,GreeBoha08,Stro08}.  The framework presented here is one of several approaches that can help shed light on this relationship.  Many approaches will be necessary, because microbial function can be viewed at multiple scales: from individual genomes through to communities and global cycles.  Detailed analysis of the functions of genomes are necessary to understand the influence of individual microbes on their community.  For example, a ubiquitous alpha-proteobacterium, SAR11, was discovered by environmental sequencing, and its role in recycling dissolved organic carbon was uncovered by a combination of laboratory and genomic analyses \cite{BritGiov91}.  Likewise, ubiquitous marine phages have uniquely viral photosynthetic genes that can influence their ability to infect and exploit \emph{Synechococcus} during low nutrient conditions \cite{sullivan_plos2005}.  Fine-scale studies of the differences in genome composition among closely related bacteria also reveal how adaptation to specific niches accompanies changes in genome composition \cite{DeneKaln10}.  Moving up in scale is difficult because metagenomic approaches that aggregate protein families do not, thus far, allow us to associate these protein families with specific strains. The analysis of microbial function via Pfam profile matrices is akin to viewing a community as a ``bag of genes"; this allows only limited inferences about community function, compared to a picture which can associate subsets of genes with specific lineages.

Although we have focused primarily on the use of NMF as a means to analyze function at a community level, NMF may also help to make specific biological predictions in assigning functions to domains of unknown function (DUFs). For example, we found that many Pfams that are strongly associated with component 2 (photosystem-related) and component 5 (phage-related) using our correlation approach (\fref{specComp}) are Domains of Unknown Function (DUFs). Follow-up analysis of the closest taxonomic matches to these DUFs is consistent with many of them sharing function with other members of the component, i.e., DUFs from component 2 have close matches to photoautotrophs (largely cyanobacteria) whereas DUFs from component 5 have close matches to phages. 

This clustering of Pfams is similar to the idea of phylogenetic profiling \cite{pellegrini_assigning_1999}, which detects proteins that have similar co-occurrence profiles across hundreds or thousands of genomes and has been used to generate hypotheses for functional annotation of unknown proteins \cite{wu_life_2005}. In contrast, our approach works by associating genes across communities from metagenomic samples. It is important to note that genes associated by this method may be from the same or different organisms; further refinement and testing are needed before any novel annotation can be assigned.  For example, it will be of interest to investigate how correlation between DUFs and protein families with known function change as the NMF rank is increased.  Moving forward, this sort of ``community profiling" could provide a useful tool, which would improve as more metagenomic samples are analyzed.

%There is a much left to do to bridge the gap between large-scale patterns of functional microbial biogeography as studied here and elsewhere \cite{PateGian10, RaesLetu11}, and fine-scale analysis of organism and community function. A key piece of the puzzle is the development of methods that can link function with specific taxa from metagenomic surveys:  which functional associations are due to associations between organisms as opposed to the presence of lineages with multiple functions?; which microbial clades are important in driving the functional differences found between habitats?   Similarly, we can ask: to what extent is functional similarity between distant, environmentally similar sites mediated by taxonomy? 

Metagenomic data provide remarkable detail coding for the functionalities of the species that comprise ecosystems, but much of that detail is likely irrelevant to the robustness of the properties that characterize those systems at macroscopic levels.   As we have shown, NMF can help link the microscopic to the macroscopic as part of a statistical framework that extracts the signal from the noise; however more work is needed.  Here we have focused on protein families, but deeper understanding of function will require linking these protein families to metabolic pathways.  Bridging from metagenomic reads to pathways in broad-scale analyses will allow us to work toward a point where quantitative predictions of community functions can be made based on sequence data as a starting point for detailed biogeochemical analysis. This approach provides hope for developing a macroscopic functional description of marine ecosystems, broadly analogous to so-called ``life-zones" in terrestrial ecosystems \cite{holdridge_determination_1947, whittaker_classification_1962}, in which the broad characteristics of ecological communities can be inferred from physico-chemical parameters.

